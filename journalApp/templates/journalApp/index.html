{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThoughtThread | Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="icon" href="{% static 'images/logos/thoughtthread-icon.png' %}">
</head>
<body>

  <header>
    <div id="header-logo">
      <a href="{% url 'index' %}">
        <img src="{% static 'images/logos/thoughtthread-logo-rect.png' %}" alt="thoughtthread." width="35%" class="blink-effect">
      </a>
    </div>

    <div id="header-nav">
      <nav>
        <a href="{% url 'profSetting' %}"><button title="Settings">
          <img src="{% static 'images/button-icons/profile.png' %}" alt="Profile Settings">
        </button></a>
        {% if user.is_authenticated %}
        <a href="{% url 'logOut' %}"><button title="Logout"><img src="{% static 'images/button-icons/logout.png' %}" alt="Logout"></button></a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main id="dashboard-page">
    <div id="entries-side">
      <h3>Journal Entries</h3>
      <div id="entries-list">
        {% for journal in allJournals %}
        <a href="{% url 'viewEntry' journal.entry_id %}">
          <button> {{ journal.title }} </button>
        </a>
        {% endfor %}
      </div>

      <div id="button">
        <a href="{% url 'newEntry' %}">
          <button>
            + New Journal Entry
          </button>
        </a>
      </div>
    </div>


    <div id="dashboard-area">
      <div id="prompts">
        <div id="prompt-heading">
          <h2 padding-top="10px">Inspiration</h2>
          <button id="refresh-quote" title="Refresh Quote" >
            <img src="{% static 'images/button-icons/refresh.png' %}" alt="Refresh" width="50%">
          </button>
        </div>

        <div id="quote-container">
          <p id="prompt-q">What does this quote make you think of?</p>
          <p id="quote-text">Loading quote...</p>
          <p id="quote-author"></p>
        </div>
      </div>


      <div id="activity">
        <div id="greeting">
          <h2 id="typewriter"></h2>
          <br>
          <p><strong>Today is:</strong> {{ today|date:"M d, Y" }}</p>
        </div>

        <div id="latest">
          <h2>Latest Entry</h2>
          <div id="latest-entry">
            {% if latestJournal %}
            <a href="{% url 'viewEntry' latestJournal.entry_id %}">
              <strong>{{ latestJournal.title }}</strong>
            </a>
            <br>

            <div id="latest-journal-entry">
              <p>{{ latestJournal.content|safe }}</p>
            </div>
            <br>
            <p>
              <strong>Tag:</strong>
              {% if latestJournal.tag %}
              {{ latestJournal.tag.name }}
              {% else %}
              No tag
              {% endif %}
            </p>
            <br>

            <p><strong>Created at:</strong> {{ latestJournal.created_at }}</p>
            {% else %}
            <p>No entries found.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <footer>
    <div>
      <a href="{% url 'index' %}">
        <img src="{% static 'images/logos/thoughtthread-logo-rect.png' %}" alt="thoughtthread.">
      </a>
    </div>
    <div id="ftr-nav">
      <a href="{% url 'index' %}">Home</a>
      <a href="{% url 'aboutUs' %}">About</a>
      <a href="mailto:contact@thoughtthread.com">Contact</a>
    </div>


    <div id="ftr-cp">
      <a>&#169;ThoughtThread 2025</a>
    </div>
  </footer>

  <script>
    async function fetchQuote () {
      try {
        const response = await fetch("http://127.0.0.1:8000/journal/zenQuote/");

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        if (!data.q || !data.a) {
          throw new Error("Invalid quote data received.");
        }

        document.getElementById("quote-text").innerText = `"${data.q}"`;
        document.getElementById("quote-author").innerText = `â€” ${data.a}`;
      } catch (error) {
        console.error("Failed to fetch quote:", error);
        document.getElementById("quote-text").innerText = "Could not load quote. Please try again.";
        document.getElementById("quote-author").innerText = "";
      }
    }

    document.getElementById("refresh-quote").addEventListener("click", fetchQuote);
    window.addEventListener("load", fetchQuote);

  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const element = document.getElementById("typewriter");
        const text = "Welcome {{ user.username }}!";
        let index = 0;
        
        function typeEffect() {
            if (index < text.length) {
                element.innerHTML = text.substring(0, index + 1); 
                index++;
                setTimeout(typeEffect, 100);
            } else {
                setTimeout(resetEffect, 9000);
            }
        }
    
        function resetEffect() {
            index = 0;
            element.innerHTML = "";
            setTimeout(typeEffect, 500);
        }
    
        typeEffect();
    });
    </script>
    <script>

      let p_c = "{{user.theme.primary_color}}"; // primary colour from database
      let s_c = "{{user.theme.secondary_color}}"; // secondary colour from database
      let t_c = "{{user.theme.tertiary_color}}"; // tertiary colour from database
  
      // setting default colours since the strings are empty when a new account is made
      if (p_c.length == 0 && s_c.length == 0 && t_c.length == 0) {
        p_c = '#383940';
        s_c = '#43545b';
        t_c = '#7b96a2';
      }
  
      // applying the three colours to the entire document's style
      document.documentElement.style.setProperty('--primary_color', p_c);
      document.documentElement.style.setProperty('--secondary_color', s_c);
      document.documentElement.style.setProperty('--tertiary_color', t_c);
  
    </script>
</body>
</html>